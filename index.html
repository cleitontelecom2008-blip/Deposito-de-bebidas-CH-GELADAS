<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>CH Geladas | PDV v4.0</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∫</text></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap');

:root {
  --primary:#3b82f6; --primary-dark:#1d4ed8;
  --bg:#060810; --surface:#0d1117; --card:#111827;
  --border:rgba(255,255,255,0.06); --border-h:rgba(59,130,246,0.4);
  --muted:#4b5563; --emerald:#10b981; --amber:#f59e0b; --red:#ef4444;
}

*{box-sizing:border-box;}

body{
  font-family:'Plus Jakarta Sans',sans-serif;
  background:var(--bg);
  background-image:radial-gradient(ellipse at 20% 50%,rgba(59,130,246,0.04) 0%,transparent 60%),
                   radial-gradient(ellipse at 80% 20%,rgba(16,185,129,0.03) 0%,transparent 50%);
  color:#f1f5f9; user-select:none;
  touch-action:manipulation; -webkit-tap-highlight-color:transparent;
  min-height:100vh;
}

/* GLASS */
.glass{background:rgba(13,17,23,0.95);border:1px solid var(--border);}
.glass-card{background:rgba(17,24,39,0.98);border:1px solid rgba(255,255,255,0.07);box-shadow:0 24px 48px rgba(0,0,0,0.4);}

/* MODALS ‚Äî visibility ao inv√©s de display:none para n√£o quebrar cliques */
.modal{
  position:fixed;inset:0;z-index:100;
  display:flex;align-items:center;justify-content:center;padding:1rem;
  background:rgba(0,0,0,0.8);
  opacity:0;visibility:hidden;pointer-events:none;
  transition:opacity .2s,visibility .2s;
}
.modal.open{opacity:1;visibility:visible;pointer-events:auto;}
.modal.open > .modal-box{animation:mIn .22s cubic-bezier(.34,1.56,.64,1) forwards;}
@keyframes mIn{from{opacity:0;transform:scale(.93) translateY(8px);}to{opacity:1;transform:scale(1) translateY(0);}}
.modal-box{background:rgba(13,17,23,0.98);border:1px solid rgba(255,255,255,0.09);border-radius:2rem;width:100%;box-shadow:0 32px 64px rgba(0,0,0,0.6);}

/* TABS */
.tab-pane{display:none;}
.tab-pane.active{display:block;animation:fadeUp .22s ease-out;}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* INPUTS */
.inp{
  background:var(--surface);border:1.5px solid rgba(255,255,255,0.07);
  border-radius:.875rem;padding:.875rem 1rem;width:100%;outline:none;
  transition:border-color .2s,box-shadow .2s;color:#f1f5f9;font-size:.875rem;
  font-family:'Plus Jakarta Sans',sans-serif;
}
.inp:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(59,130,246,.15);}
.inp::placeholder{color:#374151;}
.label{color:#60a5fa;font-size:.62rem;font-weight:800;text-transform:uppercase;letter-spacing:.08em;margin-bottom:.35rem;display:block;margin-left:.2rem;}

/* NAV TABS */
.nav-btn{color:#4b5563;transition:all .18s;flex:1;padding:.9rem .5rem;font-size:.68rem;font-weight:800;text-transform:uppercase;letter-spacing:.06em;text-align:center;border-bottom:2px solid transparent;}
.nav-btn:hover:not(.active){color:#94a3b8;background:rgba(255,255,255,0.02);}
.nav-btn.active{color:#60a5fa;border-bottom-color:#3b82f6;background:rgba(59,130,246,.06);}

/* LOCK */
#lock{position:fixed;inset:0;z-index:9999;background:radial-gradient(ellipse at 50% 40%,#0f1a2e 0%,#060810 70%);display:flex;align-items:center;justify-content:center;}

/* CARDS PDV */
.prod-card{
  background:linear-gradient(145deg,rgba(13,17,23,.98) 0%,rgba(9,12,18,1) 100%);
  border:1.5px solid rgba(255,255,255,0.06);border-left:3px solid var(--primary);
  border-radius:1.25rem;transition:all .18s;position:relative;overflow:hidden;
}
.prod-card:hover{border-color:rgba(59,130,246,.3);transform:translateY(-1px);}
.prod-card.esgotado{border-left-color:#374151;opacity:.5;}

/* BOT√ïES DE VENDA */
.btn-un,.btn-pk{border-radius:.75rem;padding:.6rem .5rem;flex:1;transition:all .15s;cursor:pointer;min-width:0;position:relative;}
.btn-un{background:rgba(59,130,246,.1);border:1.5px solid rgba(59,130,246,.18);}
.btn-un:hover{background:rgba(59,130,246,.22);}
.btn-pk{background:rgba(245,158,11,.1);border:1.5px solid rgba(245,158,11,.18);}
.btn-pk:hover{background:rgba(245,158,11,.22);}
.btn-un:active,.btn-pk:active{transform:scale(.94);}
.btn-un:disabled,.btn-pk:disabled{opacity:.3;cursor:not-allowed;transform:none!important;}

@keyframes flashBlue{0%{box-shadow:0 0 0 0 rgba(59,130,246,.8);}60%{box-shadow:0 0 0 14px rgba(59,130,246,0);}100%{box-shadow:0 0 0 0 rgba(59,130,246,0);}}
@keyframes flashAmber{0%{box-shadow:0 0 0 0 rgba(245,158,11,.8);}60%{box-shadow:0 0 0 14px rgba(245,158,11,0);}100%{box-shadow:0 0 0 0 rgba(245,158,11,0);}}
.flash-blue{animation:flashBlue .35s ease-out;}
.flash-amber{animation:flashAmber .35s ease-out;}

/* SCROLLBAR */
.scroll::-webkit-scrollbar{width:3px;}
.scroll::-webkit-scrollbar-track{background:transparent;}
.scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08);border-radius:10px;}
.no-scroll::-webkit-scrollbar{display:none;}
.no-scroll{-ms-overflow-style:none;scrollbar-width:none;}

/* BADGES */
.badge{display:inline-flex;align-items:center;border-radius:9999px;font-size:.6rem;font-weight:800;text-transform:uppercase;letter-spacing:.05em;padding:.2rem .55rem;}
.b-blue{background:rgba(59,130,246,.15);color:#60a5fa;}
.b-green{background:rgba(16,185,129,.15);color:#34d399;}
.b-amber{background:rgba(245,158,11,.15);color:#fbbf24;}
.b-red{background:rgba(239,68,68,.15);color:#f87171;}
.b-purple{background:rgba(139,92,246,.15);color:#a78bfa;}

/* BOT√ïES BASE */
.btn-p{background:#2563eb;color:#fff;border-radius:.875rem;font-weight:800;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;padding:.875rem 1.5rem;transition:all .2s;border:none;cursor:pointer;}
.btn-p:hover{background:#3b82f6;}
.btn-s{background:rgba(255,255,255,.05);color:#94a3b8;border:1px solid rgba(255,255,255,.08);border-radius:.875rem;font-weight:700;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;padding:.875rem 1.5rem;transition:all .2s;cursor:pointer;}
.btn-s:hover{background:rgba(255,255,255,.09);color:#f1f5f9;}
.btn-d{background:rgba(239,68,68,.1);color:#f87171;border:1px solid rgba(239,68,68,.2);border-radius:.875rem;font-weight:700;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;padding:.875rem 1.5rem;transition:all .2s;cursor:pointer;}
.btn-d:hover{background:#dc2626;color:#fff;border-color:#dc2626;}

/* CART ITEM ENTER */
.item-new{animation:itemIn .25s cubic-bezier(.34,1.56,.64,1);}
@keyframes itemIn{from{opacity:0;transform:translateX(12px) scale(.96);}to{opacity:1;transform:translateX(0) scale(1);}}

/* ADMIN */
.adm{display:none!important;}
body.is-admin .adm{display:block!important;}
body.is-admin .adm-flex{display:flex!important;}

/* ESTOQUE CARD */
.est-card{background:rgba(13,17,23,.85);border:1px solid var(--border);border-radius:1.25rem;transition:all .2s;}
.est-card:hover{border-color:rgba(255,255,255,.1);}

/* TOAST */
#toast{min-width:220px;position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%) translateY(4rem);opacity:0;pointer-events:none;z-index:200;transition:opacity .25s,transform .25s;}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* STAT CARD */
.stat{background:rgba(13,17,23,.85);border:1px solid var(--border);border-radius:1.5rem;padding:1.5rem;transition:all .2s;}
.stat:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.1);}

/* STOCK BTNS */
.sk-btn{width:1.75rem;height:1.75rem;border-radius:.5rem;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1rem;border:1px solid rgba(255,255,255,.06);transition:all .15s;cursor:pointer;}
.sk-m{background:rgba(239,68,68,.08);color:#f87171;}
.sk-m:hover{background:rgba(239,68,68,.25);}
.sk-p{background:rgba(16,185,129,.08);color:#34d399;}
.sk-p:hover{background:rgba(16,185,129,.25);}

/* LOADER */
#app-loader{position:fixed;inset:0;z-index:9998;background:var(--bg);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:1rem;transition:opacity .4s;}
#app-loader.hide{opacity:0;pointer-events:none;}
.spin{width:36px;height:36px;border:3px solid rgba(59,130,246,.2);border-top-color:#3b82f6;border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* FLOATING CART */
#float-cart{position:fixed;bottom:1.5rem;right:1rem;z-index:50;opacity:0;pointer-events:none;transition:opacity .3s,transform .3s;}
#float-cart.show{opacity:1;pointer-events:auto;}
</style>
</head>
<body class="min-h-screen">

<audio id="audioVenda" src="https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3" preload="auto"></audio>

<!-- LOADER (vis√≠vel enquanto sync.js restaura) -->
<div id="app-loader">
  <div class="text-center">
    <span class="text-3xl block mb-4">üç∫</span>
    <div class="spin mx-auto mb-3"></div>
    <p class="text-[10px] text-slate-600 uppercase font-black tracking-widest">Sincronizando dados...</p>
  </div>
</div>

<!-- LOCK -->
<div id="lock" style="display:none;">
  <div style="background:rgba(13,17,23,.92);border:1px solid rgba(255,255,255,.08);border-radius:2.5rem;box-shadow:0 40px 80px rgba(0,0,0,.8);padding:2.5rem;width:100%;max-width:360px;margin:0 1rem;text-align:center;">
    <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-700 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-blue-500/30 text-3xl">üç∫</div>
    <h1 class="text-2xl font-black mb-1 uppercase tracking-tight">CH <span class="text-blue-400">GELADAS</span></h1>
    <p class="text-[9px] text-slate-600 font-bold uppercase tracking-widest mb-8">PDV Enterprise v4.0</p>
    <input type="password" id="pinInput" maxlength="6" inputmode="numeric" autocomplete="off"
      class="w-full bg-slate-950 border-2 border-slate-800 focus:border-blue-500 p-5 rounded-2xl text-center text-3xl outline-none text-white tracking-[.6em] transition-all font-mono mb-4"
      placeholder="¬∑ ¬∑ ¬∑" oninput="checkPin(this.value)">
    <button onclick="doLogin()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black uppercase text-xs tracking-widest transition-all mb-3">
      <i class="fas fa-unlock-alt mr-2"></i>Aceder
    </button>
    <div class="bg-slate-950/50 rounded-xl p-2 border border-white/5">
      <p class="text-[8px] text-slate-600 uppercase font-bold">Colaborador: <span class="font-mono text-slate-500">12345</span></p>
    </div>
  </div>
</div>

<!-- MODAIS -->
<!-- P√≥s Venda -->
<div id="modalVenda" class="modal">
  <div class="modal-box max-w-md p-8 text-center">
    <div class="w-16 h-16 bg-emerald-500/20 text-emerald-400 rounded-full flex items-center justify-center mx-auto mb-5 text-2xl">‚úì</div>
    <h2 class="text-2xl font-black mb-1">Venda Realizada!</h2>
    <p class="text-slate-400 text-sm mb-7">O que deseja fazer?</p>
    <button onclick="enviarWhatsapp()" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white py-4 rounded-xl font-black uppercase text-xs mb-3 flex items-center justify-center gap-2 transition-all">
      <i class="fab fa-whatsapp text-lg"></i>Enviar Comprovante
    </button>
    <button onclick="baixarTxt()" class="w-full bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 border border-blue-500/20 py-3 rounded-xl font-black uppercase text-xs mb-3 flex items-center justify-center gap-2 transition-all">
      <i class="fas fa-download"></i>Baixar TXT
    </button>
    <button onclick="fecharModalVenda()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 py-4 rounded-xl font-black uppercase text-xs transition-all">
      Nova Venda
    </button>
  </div>
</div>

<!-- Config WhatsApp -->
<div id="modalZap" class="modal">
  <div class="modal-box max-w-sm p-8">
    <h3 class="label mb-6 !text-sm">Configura√ß√£o WhatsApp</h3>
    <p class="text-xs text-slate-400 mb-4">N√∫mero com c√≥digo do pa√≠s e DDD (s√≥ n√∫meros). Ex: 5511999999999</p>
    <input type="tel" id="zapNum" class="inp mb-6" placeholder="55..." inputmode="numeric">
    <div class="flex gap-3">
      <button onclick="salvarZap()" class="flex-1 bg-blue-600 py-3 rounded-xl font-black uppercase text-xs">Salvar</button>
      <button onclick="closeModal('modalZap')" class="flex-1 bg-slate-800 py-3 rounded-xl font-black uppercase text-xs text-slate-400">Cancelar</button>
    </div>
  </div>
</div>

<!-- Editar Venda -->
<div id="modalEditVenda" class="modal">
  <div class="modal-box max-w-sm p-8">
    <h3 class="label mb-6 !text-sm text-amber-400">Editar Venda</h3>
    <input type="hidden" id="evId">
    <div class="space-y-4 mb-6">
      <div><label class="label">Data/Hora</label><input type="text" id="evData" class="inp"></div>
      <div><label class="label">Total (R$)</label><input type="number" id="evTotal" class="inp" step="0.01"></div>
      <div><label class="label">Lucro (R$)</label><input type="number" id="evLucro" class="inp" step="0.01"></div>
    </div>
    <div class="flex gap-3">
      <button onclick="salvarEdicaoVenda()" class="flex-1 bg-amber-600 hover:bg-amber-500 py-3 rounded-xl font-black uppercase text-xs text-white">Atualizar</button>
      <button onclick="closeModal('modalEditVenda')" class="flex-1 bg-slate-800 py-3 rounded-xl font-black uppercase text-xs text-slate-400">Cancelar</button>
    </div>
  </div>
</div>

<!-- Editar Produto (modal r√°pido) -->
<div id="modalEditProd" class="modal">
  <div class="modal-box max-w-md overflow-hidden">
    <div class="p-5 border-b border-white/5 flex items-center justify-between">
      <h3 class="text-sm font-black uppercase text-blue-400"><i class="fas fa-edit mr-2"></i>Editar Produto</h3>
      <button onclick="closeModal('modalEditProd')" class="w-8 h-8 rounded-lg bg-slate-800 text-slate-400 hover:text-white flex items-center justify-center"><i class="fas fa-times text-xs"></i></button>
    </div>
    <div class="p-6 space-y-4 overflow-y-auto scroll" style="max-height:70vh">
      <input type="hidden" id="epId">
      <div class="grid grid-cols-2 gap-4">
        <div class="col-span-2"><label class="label">Nome</label><input type="text" id="epNome" class="inp"></div>
        <div><label class="label">Custo Un.</label><input type="number" id="epCusto" class="inp" step="0.01"></div>
        <div><label class="label">Pre√ßo Venda Un.</label><input type="number" id="epPreco" class="inp" step="0.01"></div>
        <div class="col-span-2">
          <label class="label">Stock Atual</label>
          <div class="flex items-center gap-2">
            <button onclick="ajusteStock(-1)" class="w-10 h-10 rounded-xl bg-slate-800 text-red-400 font-black text-lg border border-white/5 hover:bg-red-500/20 flex-shrink-0">‚àí</button>
            <input type="number" id="epQtd" class="inp text-center font-black text-lg">
            <button onclick="ajusteStock(1)" class="w-10 h-10 rounded-xl bg-slate-800 text-emerald-400 font-black text-lg border border-white/5 hover:bg-emerald-500/20 flex-shrink-0">+</button>
          </div>
        </div>
      </div>
      <!-- Entrada r√°pida -->
      <div class="bg-emerald-500/5 border border-emerald-500/15 rounded-xl p-4">
        <label class="label !text-emerald-400">Entrada de Stock</label>
        <div class="flex gap-2">
          <input type="number" id="epEntrada" class="inp" placeholder="Qtd a adicionar">
          <button onclick="entradaRapida()" class="bg-emerald-600 hover:bg-emerald-500 px-4 rounded-xl font-black text-xs text-white transition-all flex-shrink-0">+ ADD</button>
        </div>
      </div>
      <!-- Packs -->
      <div class="bg-black/20 p-4 rounded-xl border border-white/5">
        <label class="label mb-3">Packs de Venda</label>
        <div class="flex gap-2 mb-3">
          <input type="number" id="epPackUn" class="inp" placeholder="Qtd (ex: 6)">
          <input type="number" id="epPackPr" class="inp" placeholder="Pre√ßo">
          <button onclick="addPackModal()" class="bg-amber-600/20 hover:bg-amber-600/40 border border-amber-500/20 px-3 rounded-xl text-amber-300 font-black text-xs flex-shrink-0 transition-all">+</button>
        </div>
        <div id="epPackList" class="space-y-2"></div>
      </div>
    </div>
    <div class="p-5 border-t border-white/5 flex gap-3">
      <button onclick="salvarProdModal()" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black uppercase text-xs transition-all">Salvar Produto</button>
      <button onclick="closeModal('modalEditProd')" class="bg-slate-800 px-6 rounded-xl font-black uppercase text-xs text-slate-400">Cancelar</button>
    </div>
  </div>
</div>

<!-- Editar Ponto -->
<div id="modalEditPonto" class="modal">
  <div class="modal-box max-w-sm p-8">
    <h3 class="label mb-6 !text-sm text-amber-400">Editar Registo</h3>
    <input type="hidden" id="pontIdx">
    <div class="space-y-4 mb-6">
      <div><label class="label">Nome</label><input type="text" id="pontNome" class="inp"></div>
      <div>
        <label class="label">Tipo</label>
        <div class="grid grid-cols-2 gap-3">
          <button id="pontBtnE" onclick="setPontoTipo('ENTRADA')" class="py-3 rounded-xl font-black uppercase text-xs border transition-all bg-emerald-600/20 text-emerald-400 border-emerald-500/30">Entrada</button>
          <button id="pontBtnS" onclick="setPontoTipo('SA√çDA')" class="py-3 rounded-xl font-black uppercase text-xs border transition-all bg-slate-800 text-slate-500 border-white/5">Sa√≠da</button>
        </div>
        <input type="hidden" id="pontTipo" value="ENTRADA">
      </div>
      <div><label class="label">Data / Hora</label><input type="text" id="pontData" class="inp"></div>
    </div>
    <div class="flex gap-3">
      <button onclick="salvarEdicaoPonto()" class="flex-1 bg-amber-600 hover:bg-amber-500 py-4 rounded-xl font-black uppercase text-xs transition-all">Guardar</button>
      <button onclick="closeModal('modalEditPonto')" class="bg-slate-800 px-6 rounded-xl font-black uppercase text-xs text-slate-400">Cancelar</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none;" class="flex flex-col min-h-screen">

  <!-- HEADER -->
  <header class="sticky top-0 z-40 px-5 py-3 flex justify-between items-center" style="background:rgba(6,8,16,.95);border-bottom:1px solid rgba(255,255,255,.04);">
    <div class="flex items-center gap-3">
      <div class="w-9 h-9 bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl flex items-center justify-center text-sm shadow-lg shadow-blue-500/20 flex-shrink-0">üç∫</div>
      <div>
        <div class="flex items-center gap-2">
          <h2 class="text-[10px] font-black uppercase tracking-widest text-blue-400" id="roleTitle">Sistema</h2>
          <span id="roleTag" class="badge b-blue hidden">ADM</span>
        </div>
        <p id="clock" class="text-[9px] font-mono text-slate-600 mt-0.5">00:00:00</p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button id="alertaBtn" onclick="switchTab('estoque')" class="hidden items-center gap-1.5 bg-amber-500/10 text-amber-400 border border-amber-500/20 px-3 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-wide transition-all hover:bg-amber-500/20 adm-flex">
        <i class="fas fa-exclamation-triangle text-[8px]"></i>
        <span id="alertaCount">0</span> Baixo
      </button>
      <div id="syncDot" title="Sincronizado com Firestore" class="w-2 h-2 rounded-full bg-emerald-400" style="display:none;"></div>
      <button onclick="location.reload()" title="Encerrar Sess√£o" class="w-8 h-8 rounded-lg bg-slate-900 border border-white/5 flex items-center justify-center text-slate-500 hover:text-red-400 transition-all">
        <i class="fas fa-power-off text-xs"></i>
      </button>
    </div>
  </header>

  <!-- NAV -->
  <nav class="flex overflow-x-auto no-scroll" style="background:rgba(6,8,16,.98);border-bottom:1px solid rgba(255,255,255,.04);">
    <button class="nav-btn active" data-tab="vendas" onclick="switchTab('vendas')">
      <i class="fas fa-cash-register block text-base mb-1 mx-auto"></i>PDV
    </button>
    <button class="nav-btn adm" data-tab="estoque" onclick="switchTab('estoque')">
      <i class="fas fa-boxes block text-base mb-1 mx-auto"></i>Estoque
    </button>
    <button class="nav-btn adm" data-tab="financeiro" onclick="switchTab('financeiro')">
      <i class="fas fa-chart-line block text-base mb-1 mx-auto"></i>Caixa
    </button>
    <button class="nav-btn" data-tab="ponto" onclick="switchTab('ponto')">
      <i class="fas fa-user-clock block text-base mb-1 mx-auto"></i>Ponto
    </button>
    <button class="nav-btn adm" data-tab="dados" onclick="switchTab('dados')">
      <i class="fas fa-database block text-base mb-1 mx-auto"></i>Dados
    </button>
  </nav>

  <main class="flex-1 p-3 lg:p-5 max-w-7xl mx-auto w-full pb-24 lg:pb-6">

    <!-- PDV -->
    <section id="tab-vendas" class="tab-pane active">
      <div class="grid lg:grid-cols-12 gap-4">
        <!-- Cat√°logo -->
        <div class="lg:col-span-8 flex flex-col gap-3">
          <div class="flex gap-2">
            <div class="relative flex-1">
              <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-600 text-xs pointer-events-none"></i>
              <input type="text" id="searchProd" oninput="clearTimeout(this._t);this._t=setTimeout(renderCatalogo,160)" class="inp pl-10" placeholder="Pesquisar produto...">
            </div>
            <button onclick="openModal('modalZap')" class="w-12 bg-slate-900 rounded-xl flex items-center justify-center text-slate-500 hover:text-[#25D366] hover:bg-slate-800 transition-all border border-white/5 flex-shrink-0" title="WhatsApp">
              <i class="fab fa-whatsapp text-lg"></i>
            </button>
          </div>
          <!-- Stats r√°pidos -->
          <div id="pdvStats" class="grid grid-cols-3 gap-2 hidden">
            <div class="bg-slate-900/50 rounded-xl p-3 border border-white/5 text-center">
              <p class="text-[8px] text-slate-600 uppercase font-bold">Produtos</p>
              <p class="text-sm font-black" id="pdvTotal">0</p>
            </div>
            <div class="bg-slate-900/50 rounded-xl p-3 border border-white/5 text-center">
              <p class="text-[8px] text-amber-500/70 uppercase font-bold">Baixo</p>
              <p class="text-sm font-black text-amber-400" id="pdvLow">0</p>
            </div>
            <div class="bg-slate-900/50 rounded-xl p-3 border border-white/5 text-center">
              <p class="text-[8px] text-red-500/70 uppercase font-bold">Esgotado</p>
              <p class="text-sm font-black text-red-400" id="pdvOut">0</p>
            </div>
          </div>
          <div id="catalogo" class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto scroll" style="max-height:62vh"></div>
        </div>

        <!-- Carrinho -->
        <div class="lg:col-span-4">
          <div class="glass-card rounded-[2rem] flex flex-col sticky overflow-hidden" style="top:72px;max-height:calc(100vh - 90px)">
            <div class="px-5 pt-5 pb-3 border-b border-white/5">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <i class="fas fa-shopping-cart text-blue-400 text-sm"></i>
                  <span class="text-[9px] font-black uppercase tracking-wider text-blue-400">Carrinho</span>
                </div>
                <div class="flex items-center gap-2">
                  <span id="cartBadge" class="hidden badge b-blue">0</span>
                  <button onclick="limparCarrinho()" id="btnLimpar" class="hidden w-6 h-6 rounded-md bg-red-500/10 text-red-400 hover:bg-red-500/25 flex items-center justify-center transition-all">
                    <i class="fas fa-trash text-[9px]"></i>
                  </button>
                </div>
              </div>
            </div>
            <div id="carrinhoLista" class="flex-1 overflow-y-auto scroll p-4 space-y-2 min-h-[200px]"></div>
            <div class="p-5 border-t border-white/5 bg-slate-950/50">
              <div class="flex items-center justify-between mb-1">
                <span class="text-[9px] text-slate-600 uppercase font-bold tracking-wider">Total</span>
                <span id="cartCount" class="text-[9px] text-slate-600"></span>
              </div>
              <h2 id="cartTotal" class="text-3xl font-black text-white mb-4 tracking-tight">R$ 0,00</h2>
              <button onclick="finalizarVenda()" id="btnFinalizar" disabled
                class="w-full py-4 rounded-xl bg-slate-800 text-slate-500 font-black uppercase text-[10px] tracking-widest transition-all cursor-not-allowed">
                <i class="fas fa-check-circle mr-2"></i>Finalizar Venda
              </button>
              <p class="text-[7px] text-slate-700 mt-2 text-center uppercase font-bold tracking-widest">TXT gerado sob pedido</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ESTOQUE -->
    <section id="tab-estoque" class="tab-pane">
      <div class="max-w-3xl mx-auto">
        <div class="bg-slate-900/40 p-8 rounded-[2.5rem] border border-white/5 mb-8">
          <h3 id="formTitle" class="label mb-8">Novo Produto</h3>
          <input type="hidden" id="editId">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div><label class="label">Designa√ß√£o</label><input type="text" id="pNome" class="inp" placeholder="Ex: Cerveja Especial"></div>
            <div><label class="label">Custo Compra (Un.)</label><input type="number" id="pCusto" class="inp" placeholder="0.00"></div>
            <div><label class="label">Stock Inicial</label><input type="number" id="pQtd" class="inp" placeholder="0"></div>
            <div><label class="label">Pre√ßo Venda (Un.)</label><input type="number" id="pPreco" class="inp" placeholder="0.00"></div>
          </div>
          <div class="bg-black/20 p-6 rounded-3xl border border-white/5">
            <h4 class="label mb-4 !text-amber-400">Packs de Venda</h4>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <input type="number" id="tPackUn" class="inp" placeholder="Qtd (ex: 6)">
              <input type="number" id="tPackPr" class="inp" placeholder="Pre√ßo Pack">
            </div>
            <button onclick="addPackForm()" class="w-full bg-slate-800 text-slate-300 py-3 rounded-xl font-bold text-[10px] uppercase">Adicionar Pack</button>
            <div id="tPackList" class="mt-4 space-y-2"></div>
          </div>
          <div class="flex gap-4 mt-8">
            <button id="btnSalvar" onclick="salvarProduto()" class="flex-1 bg-blue-600 py-5 rounded-2xl font-black uppercase text-xs">Registar Produto</button>
            <button id="btnCancelar" onclick="resetFormEstoque()" class="hidden bg-slate-800 px-8 rounded-2xl font-black uppercase text-xs text-slate-400">Cancelar</button>
          </div>
        </div>
        <div id="gridEstoque" class="grid md:grid-cols-2 gap-4"></div>
      </div>
    </section>

    <!-- FINANCEIRO -->
    <section id="tab-financeiro" class="tab-pane">
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
        <div class="stat border-l-4 border-blue-500">
          <p class="text-[9px] font-black uppercase tracking-wider text-blue-400 mb-1">Investimento</p>
          <input type="number" id="invInput" onchange="updateInv()" class="bg-transparent text-2xl font-black w-full outline-none text-white mt-1 placeholder-slate-700" placeholder="0,00">
          <p class="text-[8px] text-slate-600 uppercase font-bold mt-1">Edite aqui</p>
        </div>
        <div class="stat border-l-4 border-emerald-500">
          <p class="text-[9px] font-black uppercase tracking-wider text-emerald-400 mb-1">Lucro L√≠quido</p>
          <h2 id="dashLucro" class="text-2xl font-black mt-1 text-emerald-400">R$ 0,00</h2>
          <p class="text-[8px] text-slate-600 uppercase font-bold mt-1">Acumulado</p>
        </div>
        <div class="stat border-l-4 border-amber-500">
          <p class="text-[9px] font-black uppercase tracking-wider text-amber-400 mb-1">ROI Global</p>
          <h2 id="dashROI" class="text-2xl font-black mt-1 text-amber-400">0%</h2>
          <p class="text-[8px] text-slate-600 uppercase font-bold mt-1">Retorno</p>
        </div>
        <div class="stat border-l-4 border-purple-500">
          <p class="text-[9px] font-black uppercase tracking-wider text-purple-400 mb-1">Fatura√ß√£o Bruta</p>
          <h2 id="dashBruto" class="text-2xl font-black mt-1 text-purple-400">R$ 0,00</h2>
          <p class="text-[8px] text-slate-600 uppercase font-bold mt-1">Total vendas</p>
        </div>
      </div>
      <div class="grid lg:grid-cols-2 gap-4">
        <div class="glass rounded-[1.75rem] overflow-hidden">
          <div class="px-6 py-4 border-b border-white/5 flex items-center justify-between">
            <div class="flex items-center gap-2"><i class="fas fa-receipt text-blue-400 text-sm"></i><span class="text-[9px] font-black uppercase tracking-wider text-blue-400">Hist√≥rico</span></div>
            <span id="totalVendas" class="badge b-blue">0 reg</span>
          </div>
          <div class="px-6 py-3 border-b border-white/5">
            <div class="flex gap-2">
              <input type="text" id="filtroData" oninput="renderFinanceiro()" class="inp !py-2 !text-xs" placeholder="Filtrar por data...">
              <button onclick="document.getElementById('filtroData').value='';renderFinanceiro();" class="px-3 rounded-xl bg-slate-900 text-slate-500 hover:text-white text-xs border border-white/5 transition-all flex-shrink-0"><i class="fas fa-times"></i></button>
            </div>
          </div>
          <div id="vendaLogs" class="overflow-y-auto scroll p-4 space-y-2" style="max-height:420px"></div>
        </div>
        <div class="space-y-4">
          <div class="glass rounded-[1.75rem] p-6 grid grid-cols-3 gap-4">
            <div class="text-center"><p class="text-[8px] text-slate-600 uppercase font-bold mb-1">Ticket M√©dio</p><p id="ticket" class="text-sm font-black">R$ 0,00</p></div>
            <div class="text-center"><p class="text-[8px] text-slate-600 uppercase font-bold mb-1">Margem</p><p id="margem" class="text-sm font-black text-emerald-400">0%</p></div>
            <div class="text-center"><p class="text-[8px] text-slate-600 uppercase font-bold mb-1">Hoje</p><p id="vendasHoje" class="text-sm font-black text-blue-400">0</p></div>
          </div>
          <div class="glass rounded-[1.75rem] p-6">
            <p class="text-[9px] font-black uppercase text-slate-500 mb-3">Break-Even</p>
            <p id="breakEven" class="text-sm font-black text-emerald-400">‚Äî</p>
          </div>
          <div class="glass rounded-[1.75rem] p-6">
            <p class="text-[8px] text-slate-500 uppercase font-bold mb-3">Exportar Relat√≥rio</p>
            <button onclick="exportarRelatorio()" class="w-full btn-p text-xs"><i class="fas fa-file-alt mr-2"></i>Baixar TXT Completo</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PONTO -->
    <section id="tab-ponto" class="tab-pane">
      <div class="max-w-2xl mx-auto space-y-4">
        <div class="glass rounded-[2rem] p-6">
          <h3 class="label mb-5">Registar Ponto</h3>
          <div class="flex gap-3 mb-4">
            <input type="text" id="pontNomeLive" class="inp flex-1" placeholder="Nome do colaborador">
          </div>
          <div class="grid grid-cols-2 gap-3">
            <button onclick="registarPonto('ENTRADA')" class="py-4 rounded-xl bg-emerald-600/20 text-emerald-300 border border-emerald-500/30 font-black text-xs uppercase hover:bg-emerald-600/30 transition-all"><i class="fas fa-sign-in-alt mr-2"></i>Entrada</button>
            <button onclick="registarPonto('SA√çDA')" class="py-4 rounded-xl bg-red-600/20 text-red-300 border border-red-500/30 font-black text-xs uppercase hover:bg-red-600/30 transition-all"><i class="fas fa-sign-out-alt mr-2"></i>Sa√≠da</button>
          </div>
        </div>
        <!-- Resumo -->
        <div class="glass rounded-[2rem] p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="label !mb-0">Registos</h3>
            <div class="flex items-center gap-2">
              <span id="pontoTotal" class="badge b-purple">0 reg</span>
              <button onclick="limparPonto()" class="adm hidden w-7 h-7 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all text-[9px]"><i class="fas fa-trash"></i></button>
            </div>
          </div>
          <div class="flex gap-2 mb-4">
            <input type="text" id="filtroPonto" oninput="renderPonto()" class="inp !py-2 !text-xs" placeholder="Filtrar por nome...">
            <button onclick="document.getElementById('filtroPonto').value='';renderPonto();" class="px-3 rounded-xl bg-slate-900 text-slate-500 hover:text-white text-xs border border-white/5 transition-all flex-shrink-0"><i class="fas fa-times"></i></button>
          </div>
          <div id="pontoResumo" class="grid grid-cols-2 gap-3 mb-4"></div>
          <div id="pontoLogs" class="space-y-2 overflow-y-auto scroll" style="max-height:400px"></div>
        </div>
      </div>
    </section>

    <!-- DADOS -->
    <section id="tab-dados" class="tab-pane">
      <div class="max-w-2xl mx-auto space-y-4">
        <div class="grid grid-cols-3 gap-3">
          <div class="stat border-l-4 border-blue-500 text-center">
            <p class="text-[8px] text-slate-600 uppercase font-bold">Produtos</p>
            <p id="statProd" class="text-2xl font-black mt-1">0</p>
          </div>
          <div class="stat border-l-4 border-emerald-500 text-center">
            <p class="text-[8px] text-slate-600 uppercase font-bold">Vendas</p>
            <p id="statVend" class="text-2xl font-black mt-1">0</p>
          </div>
          <div class="stat border-l-4 border-purple-500 text-center">
            <p class="text-[8px] text-slate-600 uppercase font-bold">Ponto</p>
            <p id="statPont" class="text-2xl font-black mt-1">0</p>
          </div>
        </div>
        <div class="glass rounded-[1.75rem] p-6">
          <p class="text-[8px] text-slate-500 uppercase font-bold mb-3">Backup</p>
          <button onclick="exportarBackup()" class="w-full btn-p mb-2"><i class="fas fa-download mr-2"></i>Exportar Backup JSON</button>
          <p id="lastBackup" class="text-[8px] text-slate-600 text-center mt-2">‚Äî</p>
        </div>
        <div class="glass rounded-[1.75rem] p-6">
          <p class="text-[8px] text-slate-500 uppercase font-bold mb-3">Restaurar Backup</p>
          <div class="border-2 border-dashed border-blue-500/30 rounded-2xl p-6 text-center hover:border-blue-500/50 transition-all cursor-pointer" onclick="document.getElementById('fileInput').click()">
            <i class="fas fa-folder-open text-blue-400 text-2xl mb-2 block"></i>
            <p class="text-[10px] text-slate-400 font-bold">Clique para selecionar ficheiro JSON</p>
          </div>
          <input type="file" id="fileInput" accept=".json" style="display:none" onchange="importarDados(this)">
          <p class="text-[8px] text-red-400/50 font-bold uppercase mt-3 text-center"><i class="fas fa-exclamation-triangle mr-1"></i>Substitui dados atuais</p>
        </div>
        <div class="glass rounded-[1.75rem] border border-red-500/15 overflow-hidden">
          <div class="p-6 flex flex-col md:flex-row items-center justify-between gap-4">
            <div>
              <h3 class="text-sm font-black uppercase text-red-400 flex items-center gap-2 mb-1"><i class="fas fa-radiation text-xs"></i>Zona de Perigo</h3>
              <p class="text-[10px] text-slate-500 font-bold">Apaga permanentemente todos os dados. Irrevers√≠vel.</p>
            </div>
            <button onclick="resetSistema()" class="btn-d whitespace-nowrap flex-shrink-0"><i class="fas fa-trash-alt mr-2"></i>Reset Total</button>
          </div>
        </div>
      </div>
    </section>

  </main>
</div><!-- /app -->

<!-- TOAST -->
<div id="toast" class="glass-card rounded-2xl px-6 py-4 flex items-center gap-3 shadow-2xl">
  <div id="toastIcon" class="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0"></div>
  <div><span id="toastMsg" class="text-[11px] font-black uppercase tracking-wide block"></span><span id="toastSub" class="text-[9px] text-slate-500 font-bold"></span></div>
</div>

<!-- FLOATING CART (mobile) -->
<button id="float-cart" onclick="document.getElementById('carrinhoLista').scrollIntoView({behavior:'smooth',block:'start'})"
  class="lg:hidden bg-blue-600 text-white rounded-2xl px-4 py-3 font-black text-xs uppercase shadow-2xl shadow-blue-500/40 border border-blue-400/20 flex items-center gap-3">
  <div class="relative">
    <i class="fas fa-shopping-cart text-base"></i>
    <span id="floatBadge" class="absolute -top-2 -right-2 w-4 h-4 bg-white text-blue-600 rounded-full text-[8px] font-black flex items-center justify-center">0</span>
  </div>
  <div class="flex flex-col items-start leading-none">
    <span id="floatCount" class="text-[8px] text-blue-200 font-bold uppercase">0 itens</span>
    <span id="floatTotal" class="text-sm font-black">R$ 0,00</span>
  </div>
  <i class="fas fa-chevron-up text-xs text-blue-300"></i>
</button>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const STORAGE_KEY = 'CH_GELADAS_DB_ENTERPRISE';
let db = { estoque:[], vendas:[], ponto:[], investimento:0, config:{whatsapp:''} };
let carrinho = [];
let tempPacks = [];
let epPacks = []; // packs no modal de edi√ß√£o r√°pida
let isAdmin = false;
let lastSale = null;
let _clockInterval = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PONTO DE ENTRADA ‚Äî chamado pelo sync.js ap√≥s restore
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.CH_INIT = function() {
  // Esconde loader, mostra lock
  const loader = document.getElementById('app-loader');
  loader.classList.add('hide');
  setTimeout(() => { loader.style.display='none'; }, 400);
  document.getElementById('lock').style.display = 'flex';

  // Carrega dados do localStorage (j√° restaurado pelo sync.js)
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      db = { ...db, ...parsed };
      if (!db.config) db.config = { whatsapp:'' };
      if (!db.estoque) db.estoque = [];
      if (!db.vendas)  db.vendas  = [];
      if (!db.ponto)   db.ponto   = [];
    } catch(e) { console.error('Erro ao ler localStorage:', e); }
  }

  document.getElementById('invInput').value = db.investimento || 0;
  document.getElementById('zapNum').value   = db.config.whatsapp || '';
};

// Fallback: se sync.js n√£o carregar em 5s, inicia mesmo assim (modo offline)
setTimeout(() => {
  if (typeof window.CH_INIT === 'function' && document.getElementById('lock').style.display === 'none') {
    window.CH_INIT();
  }
}, 5000);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SAVE ‚Äî √∫nico ponto de escrita. Chama CH_BACKUP (sync.js)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  // Backup no Firestore com debounce (definido no sync.js)
  if (typeof window.CH_BACKUP === 'function') window.CH_BACKUP();
  // Mostra dot de sync
  const dot = document.getElementById('syncDot');
  if (dot) { dot.style.display='block'; dot.style.background='#f59e0b'; setTimeout(()=>dot.style.background='#10b981',3500); }
  // Re-renderiza s√≥ o necess√°rio
  renderCatalogo();
  updateStats();
  const activeTab = document.querySelector('.tab-pane.active');
  if (activeTab) {
    if (activeTab.id === 'tab-financeiro') renderFinanceiro();
    if (activeTab.id === 'tab-estoque')    renderEstoque();
    if (activeTab.id === 'tab-ponto')      renderPonto();
    if (activeTab.id === 'tab-dados')      renderDados();
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function checkPin(val) { if(val==='001'||val==='12345') doLogin(); }
function doLogin() {
  const pin = document.getElementById('pinInput').value;
  if (pin==='001') {
    isAdmin=true; document.body.classList.add('is-admin');
    document.getElementById('roleTitle').textContent='Administrador';
    const tag=document.getElementById('roleTag'); tag.textContent='ADM'; tag.className='badge b-blue'; tag.classList.remove('hidden');
  } else if (pin==='12345') {
    isAdmin=false; document.body.classList.remove('is-admin');
    document.getElementById('roleTitle').textContent='Colaborador';
    const tag=document.getElementById('roleTag'); tag.textContent='PDV'; tag.className='badge b-purple'; tag.classList.remove('hidden');
  } else {
    showToast('PIN Inv√°lido','Tente novamente','error');
    document.getElementById('pinInput').value=''; return;
  }
  document.getElementById('lock').style.display='none';
  document.getElementById('app').style.display='flex';
  document.getElementById('syncDot').style.display='block';
  showToast('Sess√£o Iniciada', isAdmin?'Acesso Total':'Modo Colaborador');
  startClock(); renderCatalogo(); renderEstoque(); renderPonto(); updateStats();
  verificarAlertas();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CLOCK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function startClock() {
  clearInterval(_clockInterval);
  const el = document.getElementById('clock');
  const tick = () => el.textContent = new Date().toLocaleTimeString('pt-PT');
  tick(); _clockInterval = setInterval(tick, 1000);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchTab(id) {
  const btn = document.querySelector(`[data-tab="${id}"]`);
  if (!btn) return;
  if (btn.classList.contains('adm') && !isAdmin) { showToast('Negado','Apenas Administrador','error'); return; }
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  btn.classList.add('active');
  if (id==='estoque')    { resetFormEstoque(); renderEstoque(); }
  if (id==='financeiro') renderFinanceiro();
  if (id==='ponto')      renderPonto();
  if (id==='dados')      renderDados();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openModal(id)  { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PDV / CAT√ÅLOGO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderCatalogo() {
  const q = (document.getElementById('searchProd')?.value||'').toLowerCase();
  const list = db.estoque.filter(p=>p.nome.toLowerCase().includes(q));
  const cont = document.getElementById('catalogo');
  if (!cont) return;
  cont.innerHTML = list.map(p => {
    const zero=p.qtdUn<=0, low=p.qtdUn>0&&p.qtdUn<=3;
    return `<div class="prod-card p-4 ${zero?'esgotado':''}">
      <div class="flex items-start justify-between mb-3">
        <div>
          <p class="text-[.82rem] font-black text-slate-200 leading-tight">${p.nome}</p>
          <p class="text-[.65rem] font-bold mt-0.5 ${zero?'text-red-400':low?'text-amber-400':'text-slate-600'}">
            <i class="fas fa-box-open mr-1"></i>${zero?'SEM STOCK':`${p.qtdUn} un.`}${low&&!zero?' ‚ö†Ô∏è':''}
          </p>
        </div>
        <span class="text-[9px] font-black px-2 py-1 rounded-lg ${zero?'bg-red-500/20 text-red-400':low?'bg-amber-500/20 text-amber-400':'bg-emerald-500/20 text-emerald-400'}">${zero?'ESGOT.':low?'BAIXO':'OK'}</span>
      </div>
      <div class="flex flex-wrap gap-2">
        <button id="bun-${p.id}" onclick="addCart(${p.id},0,this)" ${zero?'disabled':''} class="btn-un flex-1">
          <span class="block text-[8px] font-black text-blue-400 mb-0.5">UNID.</span>
          <span class="text-sm font-black text-white">R$ ${p.precoUn.toFixed(2)}</span>
        </button>
        ${(p.packs||[]).map((pk,i)=>{
          const sem=p.qtdUn<pk.un;
          return `<button id="bpk-${p.id}-${i}" onclick="addCart(${p.id},${i+1},this)" ${sem?'disabled':''} class="btn-pk flex-1">
            <span class="block text-[8px] font-black text-amber-500 mb-0.5">PACK ${pk.un}x</span>
            <span class="text-sm font-black text-white">R$ ${pk.preco.toFixed(2)}</span>
          </button>`;
        }).join('')}
      </div>
    </div>`;
  }).join('');
  // Stats PDV
  const statsEl=document.getElementById('pdvStats');
  if(db.estoque.length>0){
    statsEl.classList.remove('hidden');
    document.getElementById('pdvTotal').textContent=db.estoque.length;
    document.getElementById('pdvLow').textContent=db.estoque.filter(p=>p.qtdUn>0&&p.qtdUn<=3).length;
    document.getElementById('pdvOut').textContent=db.estoque.filter(p=>p.qtdUn<=0).length;
  } else statsEl.classList.add('hidden');
}

function addCart(prodId, packIdx, btnEl) {
  const p = db.estoque.find(x=>x.id===prodId);
  if (!p) return;
  let item = { prodId:p.id, nome:p.nome };
  if (packIdx===0) {
    if (p.qtdUn<1) return showToast('Sem Stock',p.nome,'error');
    item.label='UNID'; item.preco=p.precoUn; item.custo=p.custoUn; item.desconto=1;
  } else {
    const pk=p.packs[packIdx-1];
    if (p.qtdUn<pk.un) return showToast('Stock Insuficiente','Pack cancelado','error');
    item.label=`PACK ${pk.un}`; item.preco=pk.preco; item.custo=p.custoUn*pk.un; item.desconto=pk.un;
  }
  carrinho.push(item);
  renderCarrinho();
  // Flash no bot√£o
  if (btnEl) {
    const cls = packIdx===0?'flash-blue':'flash-amber';
    btnEl.classList.remove(cls); void btnEl.offsetWidth; btnEl.classList.add(cls);
    setTimeout(()=>btnEl.classList.remove(cls),400);
  }
  // Float btn mobile
  const fl=document.getElementById('float-cart');
  fl.classList.add('show');
  fl.style.transform='scale(1.08)'; setTimeout(()=>fl.style.transform='scale(1)',200);
}

function renderCarrinho() {
  const cont = document.getElementById('carrinhoLista');
  if (carrinho.length===0) {
    cont.innerHTML=`<div class="flex flex-col items-center justify-center h-full text-center py-10 opacity-20">
      <i class="fas fa-shopping-cart text-4xl mb-3 text-slate-500"></i>
      <p class="text-[10px] text-slate-500 font-black uppercase tracking-wider">Carrinho vazio</p>
    </div>`;
    document.getElementById('btnLimpar').classList.add('hidden');
  } else {
    cont.innerHTML = carrinho.map((c,i)=>`
      <div class="flex justify-between items-center bg-slate-950/60 px-4 py-3 rounded-xl border border-white/5 hover:border-white/10 transition-all ${i===carrinho.length-1?'item-new':''}">
        <div class="flex items-center gap-3 min-w-0">
          <div class="w-7 h-7 rounded-lg flex items-center justify-center flex-shrink-0 ${c.label==='UNID'?'bg-blue-500/15':'bg-amber-500/15'}">
            <i class="fas ${c.label==='UNID'?'fa-cube text-blue-400':'fa-box text-amber-400'} text-[9px]"></i>
          </div>
          <div class="min-w-0">
            <p class="text-[10px] font-black text-slate-300 truncate">${c.nome}</p>
            <p class="text-[9px] text-slate-600 font-bold">${c.label} ¬∑ <span class="text-blue-400 font-black">R$ ${c.preco.toFixed(2)}</span></p>
          </div>
        </div>
        <button onclick="removerCart(${i})" class="w-6 h-6 rounded-lg bg-red-500/8 text-red-500/40 hover:bg-red-500/20 hover:text-red-400 flex items-center justify-center transition-all flex-shrink-0 ml-2">
          <i class="fas fa-times text-[9px]"></i>
        </button>
      </div>`).join('');
    document.getElementById('btnLimpar').classList.remove('hidden');
  }
  const total = carrinho.reduce((a,b)=>a+b.preco,0);
  const fmt = v => `R$ ${v.toLocaleString('pt-PT',{minimumFractionDigits:2})}`;
  document.getElementById('cartTotal').textContent = fmt(total);
  document.getElementById('cartCount').textContent = carrinho.length>0?`${carrinho.length} ${carrinho.length===1?'item':'itens'}`:'';
  const badge=document.getElementById('cartBadge');
  if (carrinho.length>0){badge.textContent=carrinho.length;badge.classList.remove('hidden');}else badge.classList.add('hidden');
  const btn=document.getElementById('btnFinalizar');
  if (carrinho.length>0){
    btn.disabled=false; btn.className='w-full py-4 rounded-xl font-black uppercase text-[10px] tracking-widest transition-all bg-blue-600 text-white shadow-lg shadow-blue-500/25 hover:bg-blue-500';
  } else {
    btn.disabled=true; btn.className='w-full py-4 rounded-xl font-black uppercase text-[10px] tracking-widest transition-all bg-slate-800 text-slate-500 cursor-not-allowed';
  }
  // Float
  const fl=document.getElementById('float-cart');
  if (carrinho.length>0){
    document.getElementById('floatCount').textContent=`${carrinho.length} ${carrinho.length===1?'item':'itens'}`;
    document.getElementById('floatTotal').textContent=fmt(total);
    document.getElementById('floatBadge').textContent=carrinho.length;
    fl.classList.add('show');
  } else fl.classList.remove('show');
}

function removerCart(i)   { carrinho.splice(i,1); renderCarrinho(); }
function limparCarrinho() {
  if(!carrinho.length) return;
  if(confirm(`Limpar ${carrinho.length} ${carrinho.length===1?'item':'itens'}?`)){
    carrinho=[]; renderCarrinho(); showToast('Carrinho','Limpo','warning');
  }
}

function finalizarVenda() {
  const btn=document.getElementById('btnFinalizar');
  if (btn.disabled||carrinho.length===0) return;
  btn.disabled=true; // evita duplo clique

  try { document.getElementById('audioVenda').play(); } catch(_){}

  const total = carrinho.reduce((a,b)=>a+b.preco,0);
  const lucro = carrinho.reduce((a,b)=>a+(b.preco-b.custo),0);

  carrinho.forEach(item=>{
    const p=db.estoque.find(x=>x.id===item.prodId);
    if(p) p.qtdUn-=item.desconto;
  });

  const venda = { id:Date.now(), total, lucro, data:new Date().toLocaleString('pt-PT'), itens:[...carrinho] };
  db.vendas.unshift(venda);
  lastSale = venda;
  carrinho = [];
  save();
  renderCarrinho();
  openModal('modalVenda');
}

function fecharModalVenda() {
  closeModal('modalVenda');
  document.getElementById('btnFinalizar').disabled=false;
}

function baixarTxt() {
  if (!lastSale) return;
  let txt=`CH GELADAS - CUPOM N√ÉO FISCAL\n`;
  txt+=`ID: ${lastSale.id} | Data: ${lastSale.data}\n`;
  txt+=`--------------------------------\n`;
  lastSale.itens.forEach(i=>txt+=`${i.label==='UNID'?'1x':i.label} ${i.nome} ... R$ ${i.preco.toFixed(2)}\n`);
  txt+=`--------------------------------\nTOTAL: R$ ${lastSale.total.toFixed(2)}\n`;
  dlBlob(txt,'text/plain',`Venda_${lastSale.id}.txt`);
}

function enviarWhatsapp() {
  if (!lastSale||!db.config.whatsapp) { if(!db.config.whatsapp) showToast('Erro','Configure o WhatsApp','error'); return; }
  let msg=`*CH GELADAS | COMPROVANTE*\nüìÖ ${lastSale.data}\n--------------------------\n`;
  lastSale.itens.forEach(i=>msg+=`${i.label==='UNID'?'1x':i.label} ${i.nome} ... R$ ${i.preco.toFixed(2)}\n`);
  msg+=`--------------------------\n*TOTAL: R$ ${lastSale.total.toFixed(2)}*\nObrigado!`;
  window.open(`https://wa.me/${db.config.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
  fecharModalVenda();
}

function salvarZap() {
  db.config.whatsapp=document.getElementById('zapNum').value.replace(/\D/g,'');
  save(); closeModal('modalZap'); showToast('WhatsApp','N√∫mero salvo');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ESTOQUE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderEstoque() {
  const grid=document.getElementById('gridEstoque');
  if (!grid) return;
  grid.innerHTML = db.estoque.length===0
    ? `<div class="md:col-span-2 text-center py-12 text-slate-700 text-[10px] font-bold uppercase"><i class="fas fa-boxes text-2xl block mb-3"></i>Sem produtos</div>`
    : db.estoque.map(p=>`
      <div class="est-card p-5 relative">
        <div class="absolute top-4 right-4 flex gap-1.5">
          <button onclick="abrirEditarProd(${p.id})" class="w-7 h-7 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-edit text-[9px]"></i></button>
          <button onclick="apagarProd(${p.id})" class="w-7 h-7 rounded-lg bg-slate-800 text-slate-600 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-times text-[9px]"></i></button>
        </div>
        <p class="text-[10px] font-black text-slate-300 pr-20 mb-3 leading-tight">${p.nome}</p>
        <div class="flex justify-between items-end">
          <div>
            <span class="block text-[7px] text-slate-600 font-black mb-1.5 uppercase">Stock</span>
            <div class="flex items-center gap-1.5">
              <button onclick="quickStock(${p.id},'rm')" class="sk-btn sk-m">‚àí</button>
              <span class="text-xl font-black min-w-[32px] text-center ${p.qtdUn<=0?'text-red-400':p.qtdUn<=3?'text-amber-400':'text-white'}">${p.qtdUn}</span>
              <button onclick="quickStock(${p.id},'add')" class="sk-btn sk-p">+</button>
            </div>
          </div>
          <div class="text-right">
            <span class="block text-[7px] text-slate-600 font-black mb-1 uppercase">Venda Un.</span>
            <span class="text-sm font-black text-slate-300">R$ ${p.precoUn.toFixed(2)}</span>
            ${p.packs&&p.packs.length>0?`<span class="block text-[8px] text-amber-400/50 font-bold mt-0.5">${p.packs.length} pack(s)</span>`:''}
          </div>
        </div>
        ${p.qtdUn<=0?'<div class="mt-2"><span class="badge b-red">Esgotado</span></div>':p.qtdUn<=3?'<div class="mt-2"><span class="badge b-amber">Stock Baixo</span></div>':''}
      </div>`).join('');
}

function addPackForm() {
  const un=parseInt(document.getElementById('tPackUn').value);
  const pr=parseFloat(document.getElementById('tPackPr').value);
  if(!un||!pr) return;
  tempPacks.push({un,preco:pr});
  document.getElementById('tPackUn').value='';
  document.getElementById('tPackPr').value='';
  renderTempPacks();
}
function renderTempPacks() {
  document.getElementById('tPackList').innerHTML=tempPacks.map((p,i)=>`
    <div class="flex justify-between items-center bg-black/40 p-3 rounded-xl border border-white/5">
      <span class="text-[10px] font-bold">Pack ${p.un} UN ‚Üí R$ ${p.preco.toFixed(2)}</span>
      <button onclick="tempPacks.splice(${i},1);renderTempPacks();" class="text-red-500 text-xs px-2"><i class="fas fa-times"></i></button>
    </div>`).join('');
}

function salvarProduto() {
  const nome=document.getElementById('pNome').value.trim();
  const custo=parseFloat(document.getElementById('pCusto').value)||0;
  const qtd=parseInt(document.getElementById('pQtd').value)||0;
  const preco=parseFloat(document.getElementById('pPreco').value)||0;
  const editId=document.getElementById('editId').value;
  if (!nome) return showToast('Erro','Nome obrigat√≥rio','error');
  if (editId) {
    const idx=db.estoque.findIndex(p=>p.id==editId);
    if (idx!==-1) db.estoque[idx]={...db.estoque[idx],nome,custoUn:custo,qtdUn:qtd,precoUn:preco,packs:[...tempPacks]};
    showToast('Sucesso','Produto atualizado');
  } else {
    db.estoque.unshift({id:Date.now(),nome,custoUn:custo,qtdUn:qtd,precoUn:preco,packs:[...tempPacks]});
    showToast('Estoque','Produto registado');
  }
  resetFormEstoque(); save();
}

function resetFormEstoque() {
  document.getElementById('formTitle').textContent='Novo Produto';
  document.getElementById('editId').value='';
  ['pNome','pCusto','pQtd','pPreco'].forEach(id=>document.getElementById(id).value='');
  tempPacks=[]; renderTempPacks();
  document.getElementById('btnSalvar').textContent='Registar Produto';
  document.getElementById('btnCancelar').classList.add('hidden');
}

function quickStock(id, tipo) {
  const p=db.estoque.find(x=>x.id===id);
  if (!p) return;
  const input=prompt(`${tipo==='add'?'ADICIONAR':'REMOVER'} em ${p.nome}\n(Atual: ${p.qtdUn})`);
  if (input!==null) {
    const qtd=parseInt(input);
    if (!isNaN(qtd)&&qtd>0) {
      p.qtdUn += tipo==='add'?qtd:-qtd;
      save(); showToast(tipo==='add'?'Entrada':'Sa√≠da',`${tipo==='add'?'+':'-'}${qtd} em ${p.nome}`,tipo==='add'?'success':'warning');
    }
  }
}

function apagarProd(id) {
  const p=db.estoque.find(x=>x.id===id);
  if (!p) return;
  if (confirm(`Apagar "${p.nome}"?`)) { db.estoque=db.estoque.filter(x=>x.id!==id); save(); }
}

// Modal edi√ß√£o r√°pida de produto
function abrirEditarProd(id) {
  const p=db.estoque.find(x=>x.id===id);
  if (!p) return;
  epPacks=JSON.parse(JSON.stringify(p.packs||[]));
  document.getElementById('epId').value=p.id;
  document.getElementById('epNome').value=p.nome;
  document.getElementById('epCusto').value=p.custoUn;
  document.getElementById('epPreco').value=p.precoUn;
  document.getElementById('epQtd').value=p.qtdUn;
  document.getElementById('epEntrada').value='';
  document.getElementById('epPackUn').value='';
  document.getElementById('epPackPr').value='';
  renderEpPacks(); openModal('modalEditProd');
}
function renderEpPacks() {
  document.getElementById('epPackList').innerHTML=epPacks.length===0
    ? `<p class="text-[9px] text-slate-500 text-center font-bold uppercase py-2">Sem packs</p>`
    : epPacks.map((pk,i)=>`
        <div class="flex justify-between items-center bg-black/30 px-4 py-3 rounded-xl border border-white/5">
          <span class="text-[10px] font-black text-amber-400">PACK ${pk.un}x</span>
          <div class="flex gap-2 items-center">
            <input type="number" value="${pk.preco}" onchange="epPacks[${i}].preco=parseFloat(this.value)||0" class="w-20 bg-slate-900 border border-white/10 rounded-lg px-2 py-1 text-[10px] text-center font-bold text-white outline-none focus:border-blue-500" step="0.01">
            <button onclick="epPacks.splice(${i},1);renderEpPacks();" class="w-7 h-7 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-times text-[9px]"></i></button>
          </div>
        </div>`).join('');
}
function addPackModal() {
  const un=parseInt(document.getElementById('epPackUn').value);
  const pr=parseFloat(document.getElementById('epPackPr').value);
  if (!un||isNaN(pr)||pr<=0) return showToast('Erro','Preencha qtd e pre√ßo','error');
  if (epPacks.find(p=>p.un===un)) return showToast('Aviso','Pack com essa qtd j√° existe','warning');
  epPacks.push({un,preco:pr});
  document.getElementById('epPackUn').value='';
  document.getElementById('epPackPr').value='';
  renderEpPacks();
}
function ajusteStock(d) {
  const inp=document.getElementById('epQtd');
  inp.value=Math.max(0,(parseInt(inp.value)||0)+d);
}
function entradaRapida() {
  const qtd=parseInt(document.getElementById('epEntrada').value);
  if (!qtd||qtd<=0) return showToast('Erro','Qtd inv√°lida','error');
  const inp=document.getElementById('epQtd');
  inp.value=(parseInt(inp.value)||0)+qtd;
  document.getElementById('epEntrada').value='';
  showToast('Entrada',`+${qtd} adicionado`);
}
function salvarProdModal() {
  const id=parseInt(document.getElementById('epId').value);
  const nome=document.getElementById('epNome').value.trim();
  const custo=parseFloat(document.getElementById('epCusto').value)||0;
  const preco=parseFloat(document.getElementById('epPreco').value)||0;
  const qtd=parseInt(document.getElementById('epQtd').value)||0;
  if (!nome) return showToast('Erro','Nome obrigat√≥rio','error');
  const idx=db.estoque.findIndex(p=>p.id==id);
  if (idx!==-1) {
    db.estoque[idx]={...db.estoque[idx],nome,custoUn:custo,precoUn:preco,qtdUn:qtd,packs:[...epPacks]};
    save(); closeModal('modalEditProd'); showToast('Produto Atualizado',nome);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FINANCEIRO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderFinanceiro() {
  const filtro=(document.getElementById('filtroData')?.value||'').toLowerCase();
  const vendas=filtro?db.vendas.filter(v=>v.data.toLowerCase().includes(filtro)):db.vendas;
  document.getElementById('totalVendas').textContent=`${vendas.length} reg`;
  const logs=document.getElementById('vendaLogs');
  logs.innerHTML=vendas.length===0
    ? `<div class="text-center py-8 text-slate-700 text-[10px] font-bold uppercase">Sem registos${filtro?' para este filtro':''}</div>`
    : vendas.map(v=>`
      <div class="flex justify-between items-center p-3 rounded-xl border border-white/5 hover:bg-slate-900/60 transition-all">
        <div class="flex flex-col gap-0.5 min-w-0">
          <div class="flex items-center gap-2">
            <span class="text-sm font-black text-white">R$ ${v.total.toFixed(2)}</span>
            <span class="badge b-blue">${v.itens.length} it.</span>
            ${v.lucro>0?`<span class="text-[8px] text-emerald-400 font-bold">+R$ ${v.lucro.toFixed(2)}</span>`:''}
          </div>
          <span class="text-[9px] text-slate-600 font-bold">${v.data}</span>
        </div>
        <div class="flex gap-1.5 flex-shrink-0">
          <button onclick="editarVenda(${v.id})" class="w-7 h-7 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-edit text-[9px]"></i></button>
          <button onclick="excluirVenda(${v.id})" class="w-7 h-7 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-trash text-[9px]"></i></button>
        </div>
      </div>`).join('');
  // KPIs
  const bruto=db.vendas.reduce((a,b)=>a+b.total,0);
  const lucro=db.vendas.reduce((a,b)=>a+b.lucro,0);
  const inv=db.investimento||0;
  const n=db.vendas.length;
  document.getElementById('dashLucro').textContent=`R$ ${lucro.toLocaleString('pt-PT',{minimumFractionDigits:2})}`;
  document.getElementById('dashBruto').textContent=`R$ ${bruto.toLocaleString('pt-PT',{minimumFractionDigits:2})}`;
  document.getElementById('dashROI').textContent=inv>0?`${((lucro/inv)*100).toFixed(1)}%`:'‚Äî';
  document.getElementById('ticket').textContent=n>0?`R$ ${(bruto/n).toFixed(2)}`:'R$ 0,00';
  document.getElementById('margem').textContent=bruto>0?`${((lucro/bruto)*100).toFixed(1)}%`:'0%';
  const hoje=new Date().toLocaleDateString('pt-PT');
  document.getElementById('vendasHoje').textContent=db.vendas.filter(v=>v.data.startsWith(hoje)).length;
  document.getElementById('breakEven').textContent=lucro>=inv?'‚úÖ Break-Even Atingido':`Falta R$ ${(inv-lucro).toFixed(2)}`;
}

function updateInv() { db.investimento=parseFloat(document.getElementById('invInput').value)||0; save(); }

function editarVenda(id) {
  const v=db.vendas.find(x=>x.id===id); if (!v) return;
  document.getElementById('evId').value=v.id;
  document.getElementById('evData').value=v.data;
  document.getElementById('evTotal').value=v.total;
  document.getElementById('evLucro').value=v.lucro;
  openModal('modalEditVenda');
}
function salvarEdicaoVenda() {
  const id=parseInt(document.getElementById('evId').value);
  const idx=db.vendas.findIndex(v=>v.id===id);
  if (idx!==-1) {
    db.vendas[idx].data=document.getElementById('evData').value;
    db.vendas[idx].total=parseFloat(document.getElementById('evTotal').value)||0;
    db.vendas[idx].lucro=parseFloat(document.getElementById('evLucro').value)||0;
    save(); closeModal('modalEditVenda'); showToast('Venda','Atualizada');
  }
}
function excluirVenda(id) {
  const v=db.vendas.find(x=>x.id===id); if (!v) return;
  if (confirm('Excluir esta venda?')) {
    if (confirm('Devolver itens ao estoque?')) {
      v.itens.forEach(item=>{ const p=db.estoque.find(x=>x.id===item.prodId); if(p) p.qtdUn+=item.desconto; });
    }
    db.vendas=db.vendas.filter(x=>x.id!==id);
    save(); showToast('Venda exclu√≠da','','warning');
  }
}

function exportarRelatorio() {
  if (!db.vendas.length) return showToast('Aviso','Sem vendas para exportar');
  let txt=`--- RELAT√ìRIO CH GELADAS ---\nGerado: ${new Date().toLocaleString('pt-PT')}\n\n`;
  db.vendas.forEach(v=>{
    txt+=`VENDA #${v.id} | ${v.data}\n`;
    v.itens.forEach(i=>txt+=`- ${i.nome} (${i.label}): R$ ${i.preco.toFixed(2)}\n`);
    txt+=`TOTAL: R$ ${v.total.toFixed(2)}\n${'-'.repeat(40)}\n`;
  });
  dlBlob(txt,'text/plain',`vendas_ch_geladas_${new Date().toISOString().split('T')[0]}.txt`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PONTO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function registarPonto(tipo) {
  const nome=document.getElementById('pontNomeLive').value.trim();
  if (!nome) return showToast('Erro','Insira o nome','error');
  db.ponto.unshift({id:Date.now(),nome,tipo,data:new Date().toLocaleString('pt-PT')});
  save(); showToast('Ponto',`${nome} ‚Üí ${tipo}`);
}

function renderPonto() {
  const filtro=(document.getElementById('filtroPonto')?.value||'').toLowerCase();
  const lista=filtro?db.ponto.filter(p=>p.nome.toLowerCase().includes(filtro)):db.ponto;
  document.getElementById('pontoTotal').textContent=`${db.ponto.length} reg`;
  document.getElementById('pontoLogs').innerHTML=lista.length===0
    ? `<div class="text-center py-8 text-slate-600 text-[10px] font-bold uppercase">Sem registos</div>`
    : lista.map(p=>{
        const ri=db.ponto.findIndex(x=>x===p);
        return `<div class="bg-slate-900/50 p-4 rounded-2xl flex justify-between items-center border border-white/5 hover:bg-slate-900 transition-all">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-xl flex items-center justify-center ${p.tipo==='ENTRADA'?'bg-emerald-500/15 text-emerald-400':'bg-red-500/15 text-red-400'}">
              <i class="fas ${p.tipo==='ENTRADA'?'fa-sign-in-alt':'fa-sign-out-alt'} text-xs"></i>
            </div>
            <div>
              <span class="block text-[11px] font-black text-slate-200">${p.nome}</span>
              <span class="text-[9px] text-slate-500">${p.data}</span>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="badge ${p.tipo==='ENTRADA'?'b-green':'b-red'}">${p.tipo}</span>
            ${isAdmin?`
            <button onclick="abrirEditarPonto(${ri})" class="w-7 h-7 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-edit text-[9px]"></i></button>
            <button onclick="apagarPonto(${ri})" class="w-7 h-7 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-trash text-[9px]"></i></button>`:''}
          </div>
        </div>`;
      }).join('');
  // Resumo
  const map={};
  db.ponto.forEach(p=>{ if(!map[p.nome])map[p.nome]={e:0,s:0}; if(p.tipo==='ENTRADA')map[p.nome].e++;else map[p.nome].s++; });
  const nomes=Object.keys(map);
  document.getElementById('pontoResumo').innerHTML=nomes.length===0
    ? `<p class="col-span-2 text-[9px] text-slate-600 text-center font-bold uppercase py-2">Sem registos ainda</p>`
    : nomes.map(n=>`<div class="bg-black/20 p-4 rounded-xl border border-white/5">
        <p class="text-[10px] font-black text-slate-300 mb-2 truncate">${n}</p>
        <div class="flex gap-2">
          <span class="badge b-green"><i class="fas fa-sign-in-alt mr-1"></i>${map[n].e}</span>
          <span class="badge b-red"><i class="fas fa-sign-out-alt mr-1"></i>${map[n].s}</span>
        </div>
      </div>`).join('');
}

function abrirEditarPonto(idx) {
  const reg=db.ponto[idx]; if (!reg) return;
  document.getElementById('pontIdx').value=idx;
  document.getElementById('pontNome').value=reg.nome;
  document.getElementById('pontData').value=reg.data;
  setPontoTipo(reg.tipo); openModal('modalEditPonto');
}
function setPontoTipo(tipo) {
  document.getElementById('pontTipo').value=tipo;
  document.getElementById('pontBtnE').className=`py-3 rounded-xl font-black uppercase text-xs border transition-all ${tipo==='ENTRADA'?'bg-emerald-600/30 text-emerald-300 border-emerald-500/50':'bg-slate-800 text-slate-500 border-white/5'}`;
  document.getElementById('pontBtnS').className=`py-3 rounded-xl font-black uppercase text-xs border transition-all ${tipo==='SA√çDA'?'bg-red-600/30 text-red-300 border-red-500/50':'bg-slate-800 text-slate-500 border-white/5'}`;
}
function salvarEdicaoPonto() {
  const idx=parseInt(document.getElementById('pontIdx').value);
  const nome=document.getElementById('pontNome').value.trim();
  const tipo=document.getElementById('pontTipo').value;
  const data=document.getElementById('pontData').value.trim();
  if (!nome) return showToast('Erro','Nome obrigat√≥rio','error');
  if (idx>=0&&idx<db.ponto.length) {
    db.ponto[idx]={...db.ponto[idx],nome,tipo,data};
    save(); closeModal('modalEditPonto'); showToast('Ponto','Registo atualizado');
  }
}
function apagarPonto(idx) {
  const reg=db.ponto[idx]; if (!reg) return;
  if (confirm(`Apagar registo de ${reg.nome}?`)) { db.ponto.splice(idx,1); save(); showToast('Ponto','Apagado','warning'); }
}
function limparPonto() {
  if (!isAdmin) return;
  if (confirm('Apagar TODOS os registos de ponto?')) { db.ponto=[]; save(); showToast('Ponto','Todos apagados','warning'); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DADOS / BACKUP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderDados() {
  document.getElementById('statProd').textContent=db.estoque.length;
  document.getElementById('statVend').textContent=db.vendas.length;
  document.getElementById('statPont').textContent=db.ponto.length;
}

function exportarBackup() {
  dlBlob(JSON.stringify(db),'application/json',`CH_Geladas_BKP_${new Date().toISOString().split('T')[0]}.json`);
  document.getElementById('lastBackup').textContent=new Date().toLocaleString('pt-PT');
  showToast('Backup','Arquivo baixado');
}
function importarDados(input) {
  const file=input.files[0]; if (!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try {
      const data=JSON.parse(e.target.result);
      input.value='';
      if (data.estoque&&Array.isArray(data.estoque)) {
        if (confirm('Substituir TODOS os dados atuais?')) {
          db={...db,...data}; save(); showToast('Sucesso','Dados restaurados!');
          setTimeout(()=>location.reload(),1500);
        }
      } else showToast('Erro','Arquivo inv√°lido','error');
    } catch(_) { input.value=''; showToast('Erro','Falha ao ler arquivo','error'); }
  };
  reader.readAsText(file);
}
function resetSistema() {
  if (confirm('Apagar TODOS os dados?\n\nEssa a√ß√£o n√£o pode ser desfeita.')) {
    const c=prompt('Digite "DELETAR" para confirmar:');
    if (c==='DELETAR') {
      db={estoque:[],vendas:[],ponto:[],investimento:0,config:{whatsapp:''}};
      save(); showToast('Reset','Dados apagados','error'); setTimeout(()=>location.reload(),1500);
    } else showToast('Cancelado','C√≥digo incorreto','error');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATS / ALERTAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateStats() {
  const el=id=>document.getElementById(id);
  if(el('statProd')) el('statProd').textContent=db.estoque.length;
  if(el('statVend')) el('statVend').textContent=db.vendas.length;
  if(el('statPont')) el('statPont').textContent=db.ponto.length;
  verificarAlertas();
}
function verificarAlertas() {
  if (!isAdmin) return;
  const baixo=db.estoque.filter(p=>p.qtdUn>0&&p.qtdUn<=3).length;
  const btn=document.getElementById('alertaBtn');
  if (!btn) return;
  if (baixo>0) { document.getElementById('alertaCount').textContent=baixo; btn.style.display='flex'; }
  else btn.style.display='none';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UTILIT√ÅRIOS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let _toastTimer=null;
function showToast(msg,sub='',type='success') {
  const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  document.getElementById('toastSub').textContent=sub;
  const colors={success:'bg-blue-500/20 text-blue-400',warning:'bg-amber-500/20 text-amber-400',error:'bg-red-500/20 text-red-400'};
  const icons={success:'check',warning:'exclamation',error:'times'};
  const ic=document.getElementById('toastIcon');
  ic.className=`w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 ${colors[type]||colors.success}`;
  ic.innerHTML=`<i class="fas fa-${icons[type]||'check'} text-[10px]"></i>`;
  t.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>t.classList.remove('show'),2800);
}

function dlBlob(content,mime,filename) {
  const blob=new Blob([content],{type:mime});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download=filename; document.body.appendChild(a); a.click();
  document.body.removeChild(a); URL.revokeObjectURL(url);
}
</script>

<!-- Firebase e Sync: sync.js chama window.CH_INIT() ap√≥s restaurar dados -->
<script type="module" src="firebase.js"></script>
<script type="module" src="sync.js"></script>
</body>
</html>